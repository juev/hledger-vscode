{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "hledger",
  "patterns": [
    {
      "include": "#comment"
    },
    {
      "include": "#directive"
    },
    {
      "include": "#transaction"
    },
    {
      "include": "#posting"
    },
    {
      "include": "#timeclock"
    },
    {
      "include": "#csv"
    }
  ],
  "repository": {
    "comment": {
      "patterns": [
        {
          "name": "comment.block.hledger",
          "begin": "^(comment)\\b",
          "beginCaptures": {
            "1": {
              "name": "keyword.directive.comment.hledger"
            }
          },
          "end": "^(end\\s+comment)\\b",
          "endCaptures": {
            "1": {
              "name": "keyword.directive.comment.hledger"
            }
          },
          "patterns": [
            {
              "include": "#url"
            },
            {
              "include": "#tag"
            }
          ]
        },
        {
          "name": "comment.line.semicolon.hledger",
          "match": ";.*$",
          "captures": {
            "0": {
              "patterns": [
                {
                  "include": "#url"
                },
                {
                  "include": "#tag"
                }
              ]
            }
          }
        },
        {
          "name": "comment.line.number-sign.hledger",
          "match": "#.*$",
          "captures": {
            "0": {
              "patterns": [
                {
                  "include": "#url"
                },
                {
                  "include": "#tag"
                }
              ]
            }
          }
        },
        {
          "name": "comment.line.asterisk.hledger",
          "match": "\\*.*$"
        }
      ]
    },
    "url": {
      "name": "markup.underline.link.hledger",
      "match": "\\b(?:https?|ftp)://[^\\s,;]+"
    },
    "tag": {
      "name": "meta.tag.hledger",
      "match": "(?<!https?)\\b([\\p{L}][\\p{L}\\p{N}_-]*)(:)([^,;\\n\\r]*?)(?=\\s*[,;]|$)",
      "captures": {
        "1": {
          "name": "entity.name.tag.hledger"
        },
        "2": {
          "name": "punctuation.separator.key-value.hledger"
        },
        "3": {
          "name": "string.unquoted.tag-value.hledger"
        }
      }
    },
    "date": {
      "name": "constant.numeric.date.hledger",
      "match": "\\d{4}[-/.]\\d{1,2}[-/.]\\d{1,2}|\\d{1,2}[-/.]\\d{1,2}[-/.]\\d{2,4}|\\d{1,2}[-/.]\\d{1,2}|\\d{4}"
    },
    "time": {
      "name": "constant.numeric.time.hledger",
      "match": "\\d{1,2}:\\d{2}(?::\\d{2})?"
    },
    "amount": {
      "patterns": [
        {
          "name": "meta.amount.hledger",
          "match": "([-+]?(?:\\d{1,3}(?:[\\s,']\\d{3})*|\\d+)(?:[.,]\\d+)?)\\s*([\\p{L}\\p{Sc}$£€¥₹₽₿₩₪₨₦₡₵₺₴₼₢₸₷₶₫]+|\"[^\"]+\")?",
          "captures": {
            "1": {
              "name": "constant.numeric.amount.hledger"
            },
            "2": {
              "name": "entity.name.type.commodity.hledger"
            }
          }
        },
        {
          "name": "meta.amount.prefix.hledger",
          "match": "([\\p{L}\\p{Sc}$£€¥₹₽₿₩₪₨₦₡₵₺₴₼₢₸₷₶₫]+|\"[^\"]+\")\\s*([-+]?(?:\\d{1,3}(?:[\\s,']\\d{3})*|\\d+)(?:[.,]\\d+)?)",
          "captures": {
            "1": {
              "name": "entity.name.type.commodity.hledger"
            },
            "2": {
              "name": "constant.numeric.amount.hledger"
            }
          }
        }
      ]
    },
    "commodity": {
      "name": "hledger.commodity",
      "match": "[\\p{L}\\p{Sc}$£€¥₹₽₿₩₪₨₦₡₵₺₴₼₢₸₷₶₫]+|\"[^\"]+\""
    },
    "account": {
      "patterns": [
        {
          "name": "hledger.account.virtual",
          "match": "\\([^)]+\\)|\\[[^\\]]+\\]"
        },
        {
          "name": "hledger.account.assets",
          "match": "\\b(Assets?|Активы)\\b[\\p{L}\\p{N}\\s:_-]*"
        },
        {
          "name": "hledger.account.expenses",
          "match": "\\b(Expenses?|Расходы)\\b[\\p{L}\\p{N}\\s:_-]*"
        },
        {
          "name": "hledger.account.liabilities",
          "match": "\\b(Liabilit(?:y|ies)|Пассивы)\\b[\\p{L}\\p{N}\\s:_-]*"
        },
        {
          "name": "hledger.account.equity",
          "match": "\\b(Equity|Собственные)\\b[\\p{L}\\p{N}\\s:_-]*"
        },
        {
          "name": "hledger.account.income",
          "match": "\\b(Income|Revenue|Доходы)\\b[\\p{L}\\p{N}\\s:_-]*"
        },
        {
          "name": "hledger.account",
          "match": "[\\p{L}\\p{N}][\\p{L}\\p{N}\\s:_-]*"
        }
      ]
    },
    "status": {
      "name": "hledger.status",
      "match": "[*!]"
    },
    "code": {
      "name": "hledger.code",
      "match": "\\([^)]+\\)"
    },
    "payee": {
      "name": "hledger.payee",
      "match": "[^|;]+"
    },
    "note": {
      "name": "hledger.note",
      "match": "\\|\\s*[^;]+"
    },
    "directive": {
      "patterns": [
        {
          "name": "meta.directive.keyword.hledger",
          "match": "^(account|alias|commodity|decimal-mark|include|P|D|Y|payee|tag)\\b",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            }
          }
        },
        {
          "name": "meta.directive.account.hledger",
          "match": "^(account)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#account"
                }
              ]
            }
          }
        },
        {
          "name": "meta.directive.commodity.hledger",
          "match": "^(commodity)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#commodity"
                },
                {
                  "include": "#amount"
                }
              ]
            }
          }
        },
        {
          "name": "meta.directive.price.hledger",
          "match": "^(P)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#date"
                },
                {
                  "include": "#commodity"
                },
                {
                  "include": "#amount"
                }
              ]
            }
          }
        },
        {
          "name": "meta.directive.include.hledger",
          "match": "^(include)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "name": "string.quoted.hledger"
            }
          }
        },
        {
          "name": "meta.directive.default.hledger",
          "match": "^(D)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#commodity"
                },
                {
                  "include": "#amount"
                }
              ]
            }
          }
        },
        {
          "name": "meta.directive.alias.hledger",
          "match": "^(alias)\\s+([^=]+)\\s*=\\s*(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#account"
                }
              ]
            },
            "3": {
              "patterns": [
                {
                  "include": "#account"
                }
              ]
            }
          }
        },
        {
          "name": "meta.directive.year.hledger",
          "match": "^(Y)\\s*(\\d{4})(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.directive.hledger"
            },
            "2": {
              "name": "constant.numeric.year.hledger"
            }
          }
        }
      ]
    },
    "transaction": {
      "patterns": [
        {
          "name": "meta.transaction.periodic.hledger",
          "match": "^(~)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.operator.periodic.hledger"
            },
            "2": {
              "name": "string.unquoted.period-expression.hledger"
            }
          }
        },
        {
          "name": "meta.transaction.auto.hledger",
          "match": "^(=)\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.operator.auto.hledger"
            },
            "2": {
              "name": "string.unquoted.query-expression.hledger"
            }
          }
        },
        {
          "name": "meta.transaction.header.hledger",
          "match": "^(\\d{4}[-/.]\\d{1,2}[-/.]\\d{1,2}|\\d{1,2}[-/.]\\d{1,2}[-/.]\\d{2,4}|\\d{1,2}[-/.]\\d{1,2}|\\d{4})\\s*([*!])?\\s*(\\([^)]+\\))?\\s*([^|;]*?)(\\|[^;]*)?(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "hledger.date"
            },
            "2": {
              "name": "hledger.status"
            },
            "3": {
              "name": "hledger.code"
            },
            "4": {
              "name": "hledger.payee"
            },
            "5": {
              "name": "hledger.note"
            }
          }
        }
      ]
    },
    "posting": {
      "patterns": [
        {
          "name": "meta.posting.with-amount.hledger",
          "match": "^\\s+([^\\s;]+(?:\\s+[^\\s;]+)*?)\\s+([-+]?\\d+(?:[.,]\\d+)?)\\s*([A-Z]{3}|[^\\s;]+)?",
          "captures": {
            "1": {
              "patterns": [
                {
                  "include": "#account"
                }
              ]
            },
            "2": {
              "name": "hledger.amount"
            },
            "3": {
              "name": "hledger.commodity"
            }
          }
        },
        {
          "name": "meta.posting.account-only.hledger",
          "match": "^\\s+([^\\s;]+(?:\\s+[^\\s;]+)*)",
          "captures": {
            "1": {
              "patterns": [
                {
                  "include": "#account"
                }
              ]
            }
          }
        }
      ]
    },
    "cost": {
      "patterns": [
        {
          "name": "meta.cost.unit.hledger",
          "match": "(@)\\s*(.+?)(?=\\s*[@=;]|$)",
          "captures": {
            "1": {
              "name": "keyword.operator.cost.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#amount"
                }
              ]
            }
          }
        },
        {
          "name": "meta.cost.total.hledger",
          "match": "(@@)\\s*(.+?)(?=\\s*[=;]|$)",
          "captures": {
            "1": {
              "name": "keyword.operator.cost.total.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#amount"
                }
              ]
            }
          }
        }
      ]
    },
    "assertion": {
      "name": "meta.assertion.hledger",
      "match": "(=={0,1})\\s*(.+?)(?=\\s*;|$)",
      "captures": {
        "1": {
          "name": "keyword.operator.assertion.hledger"
        },
        "2": {
          "patterns": [
            {
              "include": "#amount"
            }
          ]
        }
      }
    },
    "timeclock": {
      "patterns": [
        {
          "name": "meta.timeclock.hledger",
          "match": "^([ioh])\\s+(.+?)(?=\\s*;|$)",
          "captures": {
            "1": {
              "name": "keyword.operator.timeclock.hledger"
            },
            "2": {
              "patterns": [
                {
                  "include": "#date"
                },
                {
                  "include": "#time"
                },
                {
                  "include": "#amount"
                },
                {
                  "name": "string.unquoted.description.hledger",
                  "match": ".+"
                }
              ]
            }
          }
        }
      ]
    },
    "csv": {
      "patterns": [
        {
          "name": "meta.directive.csv.hledger",
          "match": "^(source|separator|skip|date-format|timezone|newest-first|decimal-mark|fields|if)\\b",
          "captures": {
            "1": {
              "name": "keyword.directive.csv.hledger"
            }
          }
        }
      ]
    }
  },
  "scopeName": "source.hledger"
}